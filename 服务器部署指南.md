# æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ å°†é¡¹ç›®éƒ¨ç½²åˆ°è‡ªå·±çš„æœåŠ¡å™¨ä¸Šã€‚

## ðŸ“‹ å‰ç½®è¦æ±‚

- æœåŠ¡å™¨æ“ä½œç³»ç»Ÿï¼šUbuntu 20.04+ / CentOS 7+ / Debian 10+
- å·²å®‰è£… Git
- å·²å®‰è£… Node.js 20+ï¼ˆå¦‚æžœä½¿ç”¨ PM2 æˆ–æ‰‹åŠ¨éƒ¨ç½²ï¼‰
- å·²å®‰è£… Docker å’Œ Docker Composeï¼ˆæŽ¨èä½¿ç”¨ Docker éƒ¨ç½²ï¼‰
- æœåŠ¡å™¨å¼€æ”¾ç«¯å£ï¼š1888ï¼ˆåº”ç”¨ç«¯å£ï¼‰ï¼Œ80/443ï¼ˆå¦‚éœ€ Nginxï¼‰

## ðŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆDocker æŽ¨èï¼‰

### 1. è¿žæŽ¥åˆ°æœåŠ¡å™¨

```bash
ssh root@your-server-ip
# æˆ–ä½¿ç”¨ä½ çš„ç”¨æˆ·å
ssh username@your-server-ip
```

### 2. å®‰è£… Docker å’Œ Docker Compose

```bash
# Ubuntu/Debian
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh
sudo usermod -aG docker $USER

# å®‰è£… Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# éªŒè¯å®‰è£…
docker --version
docker-compose --version
```

### 3. å…‹éš†é¡¹ç›®

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir -p /opt/workflow
cd /opt/workflow

# å…‹éš† GitHub ä»“åº“
git clone https://github.com/jinghoor/gongzuoliu123.git .
# æˆ–ä½¿ç”¨ SSH
# git clone git@github.com:jinghoor/gongzuoliu123.git .
```

### 4. é…ç½®çŽ¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
cd /opt/workflow
cat > .env << 'EOF'
# åº”ç”¨ç«¯å£
PORT=1888

# Node çŽ¯å¢ƒ
NODE_ENV=production

# è±†åŒ… API Keyï¼ˆå¯é€‰ï¼Œå¦‚æžœä½¿ç”¨è±†åŒ…æ¨¡åž‹ï¼‰
DOUBAO_API_KEY=09484874-9519-4aa3-9cd4-f84ef0c6d44e

# OpenAI API Keyï¼ˆå¯é€‰ï¼Œå¦‚æžœä½¿ç”¨ OpenAI æ¨¡åž‹ï¼‰
OPENAI_API_KEY=your-openai-key-here
DEFAULT_OPENAI_KEY=your-openai-key-here
EOF
```

### 5. åˆ›å»ºæ•°æ®ç›®å½•

```bash
mkdir -p data uploads logs
chmod 755 data uploads logs
```

### 6. ä½¿ç”¨ Docker éƒ¨ç½²

```bash
# æž„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹çŠ¶æ€
docker-compose ps
```

### 7. éªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps

# æµ‹è¯•åº”ç”¨
curl http://localhost:1888/health
```

åº”ç”¨çŽ°åœ¨è¿è¡Œåœ¨ `http://your-server-ip:1888`

## ðŸ”§ ä½¿ç”¨ PM2 éƒ¨ç½²ï¼ˆä¸ä½¿ç”¨ Dockerï¼‰

### 1. å®‰è£… Node.js å’Œ PM2

```bash
# å®‰è£… Node.js 20
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs

# å®‰è£… PM2
npm install -g pm2
```

### 2. å…‹éš†é¡¹ç›®å¹¶å®‰è£…ä¾èµ–

```bash
cd /opt/workflow
git clone https://github.com/jinghoor/gongzuoliu123.git .

# å®‰è£…åŽç«¯ä¾èµ–
cd backend
npm install
npm run build

# å®‰è£…å‰ç«¯ä¾èµ–å¹¶æž„å»º
cd ../frontend
npm install
npm run build
```

### 3. é…ç½®çŽ¯å¢ƒå˜é‡

```bash
cd /opt/workflow
export PORT=1888
export NODE_ENV=production
export DOUBAO_API_KEY=09484874-9519-4aa3-9cd4-f84ef0c6d44e
```

æˆ–åˆ›å»º `.env` æ–‡ä»¶å¹¶ä½¿ç”¨ `dotenv` åŠ è½½ã€‚

### 4. å¯åŠ¨åº”ç”¨

```bash
cd /opt/workflow
pm2 start ecosystem.config.js
pm2 save
pm2 startup  # è®¾ç½®å¼€æœºè‡ªå¯
```

## ðŸŒ é…ç½® Nginx åå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰

### 1. å®‰è£… Nginx

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install -y nginx

# CentOS
sudo yum install -y nginx
```

### 2. é…ç½® Nginx

```bash
sudo nano /etc/nginx/sites-available/workflow
```

ç²˜è´´ä»¥ä¸‹é…ç½®ï¼ˆæ›¿æ¢ `your-domain.com` ä¸ºä½ çš„åŸŸåï¼‰ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com;

    # å®¢æˆ·ç«¯æœ€å¤§ä¸Šä¼ æ–‡ä»¶å¤§å°
    client_max_body_size 30M;

    # å‰ç«¯å’Œ API ä»£ç†
    location / {
        proxy_pass http://localhost:1888;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # ä¸Šä¼ æ–‡ä»¶è®¿é—®
    location /uploads {
        proxy_pass http://localhost:1888;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
    }
}
```

### 3. å¯ç”¨é…ç½®

```bash
# Ubuntu/Debian
sudo ln -s /etc/nginx/sites-available/workflow /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx

# CentOS
sudo cp /etc/nginx/sites-available/workflow /etc/nginx/conf.d/workflow.conf
sudo nginx -t
sudo systemctl reload nginx
```

## ðŸ”’ é…ç½® SSL è¯ä¹¦ï¼ˆLet's Encryptï¼‰

```bash
# å®‰è£… Certbot
sudo apt install -y certbot python3-certbot-nginx

# èŽ·å–è¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸæµ‹è¯•
sudo certbot renew --dry-run
```

## ðŸ“ å¸¸ç”¨ç®¡ç†å‘½ä»¤

### Docker æ–¹å¼

```bash
# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# é‡å¯æœåŠ¡
docker-compose restart

# åœæ­¢æœåŠ¡
docker-compose stop

# æ›´æ–°ä»£ç å¹¶é‡æ–°éƒ¨ç½²
cd /opt/workflow
git pull
docker-compose up -d --build

# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps
```

### PM2 æ–¹å¼

```bash
# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs cross-border-workflow

# é‡å¯
pm2 restart cross-border-workflow

# åœæ­¢
pm2 stop cross-border-workflow

# æ›´æ–°ä»£ç å¹¶é‡æ–°éƒ¨ç½²
cd /opt/workflow
git pull
cd backend && npm run build
cd ../frontend && npm run build
pm2 restart cross-border-workflow
```

## ðŸ”„ è‡ªåŠ¨æ›´æ–°è„šæœ¬

åˆ›å»ºè‡ªåŠ¨æ›´æ–°è„šæœ¬ï¼š

```bash
cat > /opt/workflow/update.sh << 'EOF'
#!/bin/bash
set -e

cd /opt/workflow

echo "ðŸ”„ æ‹‰å–æœ€æ–°ä»£ç ..."
git pull

echo "ðŸ”¨ é‡æ–°æž„å»º..."
docker-compose up -d --build

echo "âœ… æ›´æ–°å®Œæˆï¼"
EOF

chmod +x /opt/workflow/update.sh
```

ä½¿ç”¨ï¼š`/opt/workflow/update.sh`

## ðŸ›¡ï¸ é˜²ç«å¢™é…ç½®

```bash
# Ubuntu/Debian (UFW)
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 1888/tcp  # å¦‚æžœç›´æŽ¥è®¿é—®åº”ç”¨ç«¯å£
sudo ufw enable

# CentOS (firewalld)
sudo firewall-cmd --permanent --add-port=22/tcp
sudo firewall-cmd --permanent --add-port=80/tcp
sudo firewall-cmd --permanent --add-port=443/tcp
sudo firewall-cmd --permanent --add-port=1888/tcp
sudo firewall-cmd --reload
```

## ðŸ“Š æ•°æ®å¤‡ä»½

```bash
# å¤‡ä»½æ•°æ®ç›®å½•
tar -czf backup-$(date +%Y%m%d).tar.gz data/ uploads/

# æ¢å¤å¤‡ä»½
tar -xzf backup-YYYYMMDD.tar.gz
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **çŽ¯å¢ƒå˜é‡å®‰å…¨**ï¼šä¸è¦å°† `.env` æ–‡ä»¶æäº¤åˆ° Git
2. **æ•°æ®æŒä¹…åŒ–**ï¼šç¡®ä¿ `data/` å’Œ `uploads/` ç›®å½•å·²æŒ‚è½½åˆ° Docker volume
3. **ç«¯å£å†²çª**ï¼šç¡®ä¿ 1888 ç«¯å£æœªè¢«å ç”¨
4. **å†…å­˜è¦æ±‚**ï¼šå»ºè®®è‡³å°‘ 2GB RAM
5. **ç£ç›˜ç©ºé—´**ï¼šç¡®ä¿æœ‰è¶³å¤Ÿç©ºé—´å­˜å‚¨ä¸Šä¼ æ–‡ä»¶

## ðŸ› æ•…éšœæŽ’æŸ¥

### æŸ¥çœ‹åº”ç”¨æ—¥å¿—

```bash
# Docker
docker-compose logs -f app

# PM2
pm2 logs cross-border-workflow
```

### æ£€æŸ¥ç«¯å£å ç”¨

```bash
netstat -tulpn | grep 1888
# æˆ–
ss -tulpn | grep 1888
```

### æ£€æŸ¥å®¹å™¨çŠ¶æ€

```bash
docker ps -a
docker logs cross-border-workflow
```

## ðŸ“ž èŽ·å–å¸®åŠ©

å¦‚æžœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. åº”ç”¨æ—¥å¿—
2. ç³»ç»Ÿæ—¥å¿—ï¼š`journalctl -u docker` æˆ– `journalctl -u nginx`
3. ç½‘ç»œè¿žæŽ¥ï¼š`curl http://localhost:1888/health`
