# éƒ¨ç½²é—®é¢˜ä¿®å¤æŒ‡å—

## ðŸ” é—®é¢˜è¯Šæ–­

ä»Žä½ çš„ç»ˆç«¯æ—¥å¿—çœ‹åˆ°ä»¥ä¸‹é—®é¢˜ï¼š

1. âŒ **Docker å®‰è£…å¤±è´¥** - æ— æ³•è¿žæŽ¥åˆ° Docker å®˜æ–¹ä»“åº“
2. âŒ **é¡¹ç›®ç›®å½•ä¸å­˜åœ¨** - `/opt/workflow` æœªåˆ›å»º
3. âŒ **Docker Compose æœªå®‰è£…**
4. âŒ **æœåŠ¡æœªè¿è¡Œ** - æ‰€ä»¥æ— æ³•è®¿é—®ç½‘é¡µ

## ðŸš€ å¿«é€Ÿä¿®å¤æ–¹æ¡ˆï¼ˆæŽ¨èï¼‰

### åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# 1. ä¸‹è½½å®Œæ•´éƒ¨ç½²è„šæœ¬
curl -fsSL https://raw.githubusercontent.com/jinghoor/gongzuoliu123/main/complete-deploy.sh -o complete-deploy.sh

# 2. æ·»åŠ æ‰§è¡Œæƒé™
chmod +x complete-deploy.sh

# 3. è¿è¡Œå®Œæ•´éƒ¨ç½²è„šæœ¬ï¼ˆä¼šè‡ªåŠ¨ä¿®å¤ Docker å¹¶å®Œæˆéƒ¨ç½²ï¼‰
bash complete-deploy.sh
```

è¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- âœ… ä½¿ç”¨å¤šç§æ–¹æ³•å®‰è£… Dockerï¼ˆå¦‚æžœå®˜æ–¹æºå¤±è´¥ä¼šå°è¯•å¤‡ç”¨æ–¹æ³•ï¼‰
- âœ… å®‰è£… Docker Compose
- âœ… å…‹éš†é¡¹ç›®ä»£ç 
- âœ… é…ç½®çŽ¯å¢ƒå˜é‡
- âœ… å¯åŠ¨æœåŠ¡

## ðŸ“ æ‰‹åŠ¨ä¿®å¤æ­¥éª¤ï¼ˆå¦‚æžœè‡ªåŠ¨è„šæœ¬å¤±è´¥ï¼‰

### æ­¥éª¤ 1ï¼šä¿®å¤ Docker å®‰è£…

```bash
# å¸è½½æ—§ç‰ˆæœ¬
apt remove -y docker docker-engine docker.io containerd runc 2>/dev/null || true

# ä½¿ç”¨å®˜æ–¹å®‰è£…è„šæœ¬ï¼ˆæœ€å¯é ï¼‰
curl -fsSL https://get.docker.com -o get-docker.sh
bash get-docker.sh
rm get-docker.sh

# å¯åŠ¨ Docker
systemctl start docker
systemctl enable docker

# éªŒè¯
docker --version
```

### æ­¥éª¤ 2ï¼šå®‰è£… Docker Compose

```bash
# ä¸‹è½½ Docker Compose
curl -L "https://github.com/docker/compose/releases/download/v2.24.5/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x /usr/local/bin/docker-compose

# åˆ›å»ºç¬¦å·é“¾æŽ¥
ln -sf /usr/local/bin/docker-compose /usr/bin/docker-compose

# éªŒè¯
docker-compose --version
```

### æ­¥éª¤ 3ï¼šå…‹éš†é¡¹ç›®

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir -p /opt/workflow
cd /opt/workflow

# å…‹éš†é¡¹ç›®
git clone https://github.com/jinghoor/gongzuoliu123.git .
```

### æ­¥éª¤ 4ï¼šé…ç½®çŽ¯å¢ƒ

```bash
# åˆ›å»ºæ•°æ®ç›®å½•
mkdir -p data uploads logs

# åˆ›å»ºçŽ¯å¢ƒå˜é‡æ–‡ä»¶
cat > .env << 'EOF'
PORT=1888
NODE_ENV=production
DOUBAO_API_KEY=09484874-9519-4aa3-9cd4-f84ef0c6d44e
EOF

chmod 600 .env
```

### æ­¥éª¤ 5ï¼šå¯åŠ¨æœåŠ¡

```bash
# æž„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build

# æŸ¥çœ‹çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### æ­¥éª¤ 6ï¼šéªŒè¯éƒ¨ç½²

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:1888/health

# åº”è¯¥è¿”å›ž: {"status":"ok"} æˆ–ç±»ä¼¼å†…å®¹
```

## ðŸ”¥ é…ç½®é˜²ç«å¢™

```bash
# æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
ufw status

# å¦‚æžœæœªå¯ç”¨ï¼Œå…ˆå¯ç”¨
ufw enable

# å…è®¸ SSHï¼ˆé‡è¦ï¼ï¼‰
ufw allow 22/tcp

# å…è®¸åº”ç”¨ç«¯å£
ufw allow 1888/tcp

# é‡æ–°åŠ è½½
ufw reload

# æŸ¥çœ‹è§„åˆ™
ufw status numbered
```

## ðŸŒ è®¿é—®åº”ç”¨

éƒ¨ç½²æˆåŠŸåŽï¼Œåœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š

```
http://115.190.192.248:1888
```

## ðŸ› æ•…éšœæŽ’æŸ¥

### é—®é¢˜ 1ï¼šDocker å®‰è£…è„šæœ¬ä¸‹è½½å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ç½‘ç»œè¿žæŽ¥
ping github.com
ping get.docker.com

# å¦‚æžœæ— æ³•è®¿é—®ï¼Œå¯èƒ½éœ€è¦é…ç½®ä»£ç†æˆ–ä½¿ç”¨å›½å†…é•œåƒ
```

### é—®é¢˜ 2ï¼šDocker Compose ä¸‹è½½å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å°è¯•ä½¿ç”¨ apt å®‰è£…ï¼ˆç‰ˆæœ¬å¯èƒ½è¾ƒæ—§ä½†å¯ç”¨ï¼‰
apt update
apt install -y docker-compose

# æˆ–æ‰‹åŠ¨ä¸‹è½½ï¼ˆå¦‚æžœ GitHub å¯è®¿é—®ï¼‰
wget https://github.com/docker/compose/releases/download/v2.24.5/docker-compose-linux-x86_64
mv docker-compose-linux-x86_64 /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
```

### é—®é¢˜ 3ï¼šå®¹å™¨å¯åŠ¨å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
cd /opt/workflow

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose logs

# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps

# é‡æ–°æž„å»º
docker-compose down
docker-compose build --no-cache
docker-compose up -d
```

### é—®é¢˜ 4ï¼šæ— æ³•è®¿é—®ç½‘é¡µï¼ˆERR_EMPTY_RESPONSEï¼‰

**æ£€æŸ¥æ¸…å•**ï¼š

1. **æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ**ï¼š
```bash
cd /opt/workflow
docker-compose ps
# åº”è¯¥çœ‹åˆ°çŠ¶æ€ä¸º "Up"
```

2. **æ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬**ï¼š
```bash
netstat -tulpn | grep 1888
# æˆ–
ss -tulpn | grep 1888
```

3. **æ£€æŸ¥é˜²ç«å¢™**ï¼š
```bash
ufw status
# ç¡®ä¿ 1888 ç«¯å£å·²å¼€æ”¾
```

4. **æŸ¥çœ‹åº”ç”¨æ—¥å¿—**ï¼š
```bash
cd /opt/workflow
docker-compose logs app
```

5. **æµ‹è¯•æœ¬åœ°è®¿é—®**ï¼š
```bash
curl http://localhost:1888/health
# å¦‚æžœæœ¬åœ°å¯ä»¥è®¿é—®ï¼Œé—®é¢˜å¯èƒ½åœ¨é˜²ç«å¢™æˆ–ç½‘ç»œé…ç½®
```

### é—®é¢˜ 5ï¼šç½‘ç»œè¿žæŽ¥é—®é¢˜

å¦‚æžœæœåŠ¡å™¨æ— æ³•è®¿é—® GitHub æˆ– Docker å®˜æ–¹æºï¼š

**ä½¿ç”¨å›½å†…é•œåƒ**ï¼š
```bash
# é…ç½® Docker é•œåƒåŠ é€Ÿ
mkdir -p /etc/docker
cat > /etc/docker/daemon.json << 'EOF'
{
  "registry-mirrors": [
    "https://docker.mirrors.ustc.edu.cn",
    "https://hub-mirror.c.163.com"
  ]
}
EOF

systemctl restart docker
```

## âœ… éªŒè¯éƒ¨ç½²æˆåŠŸ

éƒ¨ç½²æˆåŠŸåŽï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

1. âœ… æ‰§è¡Œ `docker --version` çœ‹åˆ° Docker ç‰ˆæœ¬
2. âœ… æ‰§è¡Œ `docker-compose --version` çœ‹åˆ° Docker Compose ç‰ˆæœ¬
3. âœ… æ‰§è¡Œ `docker-compose ps` çœ‹åˆ°å®¹å™¨çŠ¶æ€ä¸º "Up"
4. âœ… æ‰§è¡Œ `curl http://localhost:1888/health` è¿”å›žæˆåŠŸ
5. âœ… åœ¨æµè§ˆå™¨è®¿é—® `http://115.190.192.248:1888` çœ‹åˆ°ç™»å½•é¡µé¢

## ðŸ“ž èŽ·å–å¸®åŠ©

å¦‚æžœä»¥ä¸Šæ–¹æ³•éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·æä¾›ï¼š

1. `docker --version` çš„è¾“å‡º
2. `docker-compose --version` çš„è¾“å‡º
3. `cd /opt/workflow && docker-compose ps` çš„è¾“å‡º
4. `cd /opt/workflow && docker-compose logs` çš„è¾“å‡º
5. `curl http://localhost:1888/health` çš„è¾“å‡º

è¿™äº›ä¿¡æ¯å¯ä»¥å¸®åŠ©è¿›ä¸€æ­¥è¯Šæ–­é—®é¢˜ã€‚
