# 🚀 第四步和第五步：部署操作指南

## ✅ 当前状态
- ✅ 代码已推送到 GitHub: https://github.com/jinghoor/gongzuoliu123
- ✅ 所有配置文件已就绪

---

## 📦 第四步：部署后端到 Railway

### 步骤 1：访问 Railway 并登录（2分钟）

1. **打开浏览器**，访问：https://railway.app
2. 点击 **"Login"** 或 **"Start a New Project"**
3. 选择 **"Login with GitHub"**
4. 授权 Railway 访问你的 GitHub 账号

### 步骤 2：创建新项目（3分钟）

1. 登录后，点击绿色的 **"New Project"** 按钮
2. 选择 **"Deploy from GitHub repo"**
3. 在仓库列表中找到 **`gongzuoliu123`**
4. 点击仓库名称，Railway 会自动开始部署

### 步骤 3：配置后端服务 ⚠️ 重要！（5分钟）

Railway 可能会自动部署，但我们需要手动配置：

1. **进入服务页面**：
   - 在项目页面，你会看到一个服务卡片
   - 点击服务卡片或服务名称进入详情

2. **设置 Root Directory**：
   - 点击 **"Settings"** 标签
   - 找到 **"Source"** 部分
   - 点击 **"Configure"** 或找到 **"Root Directory"**
   - 输入：`backend`
   - 点击 **"Save"** 或 **"Deploy"**

3. **设置构建和启动命令**：
   - 在 Settings 中找到 **"Build Command"**（可能已经自动检测）
   - 确认 Build Command 为：`npm install && npm run build`
   - 确认 Start Command 为：`npm start`
   - 如果没有，手动添加：
     - **Build Command**: `npm install && npm run build`
     - **Start Command**: `npm start`

### 步骤 4：添加环境变量（1分钟）

1. 在服务页面，点击 **"Variables"** 标签
2. 点击 **"New Variable"** 或 **"Raw Editor"**
3. 添加以下环境变量：
   ```
   NODE_ENV = production
   ```
4. 点击 **"Add"** 或 **"Save"**

### 步骤 5：等待部署完成（2-5分钟）

1. 点击 **"Deployments"** 标签查看部署进度
2. 等待部署完成（看到绿色的 "Deployed" 状态）
3. 如果部署失败，点击部署日志查看错误信息

### 步骤 6：获取后端 URL 📝（1分钟）

1. 部署成功后，点击 **"Settings"** 标签
2. 找到 **"Networking"** 部分
3. 你会看到一个 **"Public Domain"**，类似：
   ```
   https://xxx-production.up.railway.app
   ```
4. **复制这个 URL！这是你的后端地址！** 🎯

   ⚠️ **重要**：请把这个 URL 保存好，下一步部署前端时需要用到！

### 步骤 7：测试后端（1分钟）

在浏览器中打开你的后端 URL，应该能看到响应。也可以访问：
- `你的后端URL/workflows` - 应该返回空的 JSON 数组 `[]`

---

## 🎨 第五步：部署前端到 Vercel

### 步骤 1：访问 Vercel 并登录（2分钟）

1. **打开浏览器**，访问：https://vercel.com
2. 点击 **"Sign Up"** 或 **"Log In"**
3. 选择 **"Continue with GitHub"**
4. 授权 Vercel 访问你的 GitHub 账号

### 步骤 2：导入项目（2分钟）

1. 登录后，点击 **"Add New Project"** 或 **"Import Project"**
2. 在仓库列表中找到 **`jinghoor/gongzuoliu123`**
3. 点击仓库旁边的 **"Import"** 按钮

### 步骤 3：配置项目（3分钟）

在配置页面，设置以下选项：

1. **Framework Preset**：
   - 应该自动检测为 **"Vite"**
   - 如果没有，从下拉菜单选择 **"Vite"**

2. **Root Directory** ⚠️ 重要！
   - 点击 **"Edit"** 按钮（在 Framework Preset 旁边）
   - 输入：`frontend`
   - 点击 **"Continue"** 或确认

3. **Build and Output Settings**（通常已自动填充）：
   - **Build Command**: `npm run build` ✅
   - **Output Directory**: `dist` ✅
   - **Install Command**: `npm install` ✅

### 步骤 4：添加环境变量 ⚠️ 非常关键！（2分钟）

这是**最关键的一步**！如果没有正确配置，前端将无法连接后端！

1. 在配置页面，找到 **"Environment Variables"** 部分
2. 点击输入框或 **"Add"** 按钮
3. 添加以下环境变量：
   - **Name**: `VITE_API_BASE_URL`
   - **Value**: 粘贴你在第四步获取的 Railway 后端 URL
     ```
     例如：https://xxx-production.up.railway.app
     ```
   - **Environment**: 勾选所有三个选项：
     - ✅ Production
     - ✅ Preview  
     - ✅ Development
4. 点击 **"Add"** 或 **"Save"**

   ⚠️ **确认**：环境变量值应该以 `https://` 开头，以 `.railway.app` 结尾，**不要**包含末尾的斜杠 `/`

### 步骤 5：部署（2-5分钟）

1. 确认所有配置正确后，向下滚动
2. 点击绿色的 **"Deploy"** 按钮
3. 等待构建完成（通常 1-3 分钟）
4. 构建过程中可以看到实时日志

### 步骤 6：获取前端 URL 🎉（1分钟）

部署成功后，你会看到一个页面，显示：
- **Production URL**: `https://gongzuoliu123.vercel.app`（或类似）
- **Preview URL**: `https://gongzuoliu123-xxx.vercel.app`

**这就是你的应用地址！** 🎉

### 步骤 7：测试应用（2分钟）

1. **访问应用**：
   - 在浏览器中打开 Vercel 给你的 Production URL

2. **检查功能**：
   - ✅ 页面正常加载
   - ✅ 可以创建新工作流
   - ✅ 可以保存工作流
   - ✅ 可以加载已有工作流

3. **检查错误**：
   - 打开浏览器开发者工具（按 `F12` 或 `Cmd+Option+I`）
   - 查看 **Console** 标签
   - 确认没有红色错误
   - 如果看到 `VITE_API_BASE_URL` 相关的错误，检查环境变量配置

---

## 🎉 完成！

恭喜！你的应用已经成功部署到云端了！

### 你的应用地址：
- **前端（用户访问）**: `https://你的项目名.vercel.app`
- **后端 API**: `https://你的项目名.railway.app`

### 下一步：
- 测试所有功能
- 分享应用链接给其他人使用
- 配置自定义域名（可选）

---

## 🐛 常见问题排查

### 问题 1：前端无法连接后端

**症状**：打开应用后，无法创建或加载工作流，浏览器 Console 有错误

**解决方法**：
1. 检查 Vercel 环境变量 `VITE_API_BASE_URL` 是否正确
2. 确认后端 URL 可访问（在浏览器中打开后端 URL）
3. 检查后端 URL 格式：
   - ✅ 正确：`https://xxx-production.up.railway.app`
   - ❌ 错误：`https://xxx-production.up.railway.app/`（末尾不要斜杠）

### 问题 2：Railway 部署失败

**症状**：Railway 显示部署失败

**解决方法**：
1. 点击失败的部署，查看日志
2. 确认 Root Directory 设置为 `backend`
3. 确认 Build Command 和 Start Command 正确
4. 检查代码是否有语法错误

### 问题 3：Vercel 构建失败

**症状**：Vercel 构建失败

**解决方法**：
1. 在 Vercel 项目页面查看构建日志
2. 确认 Root Directory 设置为 `frontend`
3. 确认 Build Command 为 `npm run build`
4. 确认 Output Directory 为 `dist`

### 问题 4：环境变量不生效

**症状**：设置了环境变量，但前端仍然连接 localhost

**解决方法**：
1. 在 Vercel 项目 Settings → Environment Variables 确认变量已添加
2. 确认变量名完全正确：`VITE_API_BASE_URL`（注意大小写）
3. 重新部署（Vercel 会自动重新部署，或手动触发）
4. 清除浏览器缓存

---

## 📝 快速检查清单

部署完成后，确认以下事项：

- [ ] Railway 后端部署成功，状态为 "Deployed"
- [ ] 后端 URL 可以访问
- [ ] Vercel 前端部署成功
- [ ] 前端环境变量 `VITE_API_BASE_URL` 已设置
- [ ] 前端可以正常访问
- [ ] 可以创建新工作流
- [ ] 可以保存和加载工作流
- [ ] 浏览器 Console 没有错误

---

## 📞 需要帮助？

如果遇到问题：
1. 查看各平台的构建日志
2. 检查浏览器 Console 错误
3. 确认所有配置步骤都已完成
4. 参考详细文档：`开始部署.md`

**祝你部署顺利！** 🚀
