# 服务器登录和部署步骤

## 📋 服务器信息

- **主机名**: iv-yedn9gok5c5i3z4jgmqj
- **公网IP**: 115.190.192.248
- **端口**: 22
- **用户名**: root

## 🔐 第一步：登录服务器

### 在本地电脑（Mac/Windows/Linux）打开终端，执行：

```bash
ssh root@115.190.192.248 -p 22
```

**如果是第一次连接**，会提示确认服务器指纹，输入 `yes` 并按回车。

**如果需要输入密码**，输入你的 root 密码（输入时不会显示，直接输入后按回车）。

### 登录成功后，你会看到类似这样的提示：

```
Welcome to Ubuntu 20.04 LTS
root@iv-yedn9gok5c5i3z4jgmqj:~#
```

## 🚀 第二步：执行一键部署

登录成功后，在服务器上依次执行以下命令：

### 1. 下载部署脚本

```bash
curl -fsSL https://raw.githubusercontent.com/jinghoor/gongzuoliu123/main/ubuntu20-deploy.sh -o ubuntu20-deploy.sh
```

### 2. 给脚本添加执行权限

```bash
chmod +x ubuntu20-deploy.sh
```

### 3. 运行部署脚本

```bash
bash ubuntu20-deploy.sh
```

**注意**：脚本会自动使用 sudo，所以直接运行即可。

### 4. 等待部署完成

部署过程大约需要 5-10 分钟，脚本会自动：
- ✅ 更新系统
- ✅ 安装 Docker
- ✅ 安装 Docker Compose
- ✅ 克隆项目代码
- ✅ 配置环境变量
- ✅ 启动服务

你会看到类似这样的输出：

```
🚀 Ubuntu 20.04 服务器部署脚本
==================================
📋 检查系统版本...
✅ 系统版本: Ubuntu 20.04
📦 更新系统包...
🐳 安装 Docker...
...
🎉 部署完成！
```

## ✅ 第三步：验证部署

部署完成后，执行以下命令验证：

### 1. 检查服务状态

```bash
cd /opt/workflow
docker-compose ps
```

应该看到容器状态为 `Up`。

### 2. 测试健康检查

```bash
curl http://localhost:1888/health
```

应该返回 `{"status":"ok"}` 或类似内容。

### 3. 查看日志（可选）

```bash
docker-compose logs -f
```

按 `Ctrl+C` 退出日志查看。

## 🌐 第四步：访问网页工作流程序

部署成功后，你可以通过以下方式访问：

### 方式一：直接通过 IP 访问（推荐）

在浏览器中打开：

```
http://115.190.192.248:1888
```

### 方式二：如果配置了域名

```
http://your-domain.com:1888
```

## 📝 完整命令清单（复制粘贴）

如果你想要一次性复制所有命令，可以按顺序执行：

```bash
# 1. 下载部署脚本
curl -fsSL https://raw.githubusercontent.com/jinghoor/gongzuoliu123/main/ubuntu20-deploy.sh -o ubuntu20-deploy.sh

# 2. 添加执行权限
chmod +x ubuntu20-deploy.sh

# 3. 运行部署脚本
bash ubuntu20-deploy.sh

# 4. 等待部署完成（约 5-10 分钟）

# 5. 验证部署
cd /opt/workflow
docker-compose ps
curl http://localhost:1888/health
```

## 🔧 常用管理命令

部署完成后，你可以使用以下命令管理服务：

```bash
# 进入项目目录
cd /opt/workflow

# 查看服务状态
docker-compose ps

# 查看日志
docker-compose logs -f

# 重启服务
docker-compose restart

# 停止服务
docker-compose stop

# 启动服务
docker-compose start

# 更新代码并重新部署
git pull
docker-compose up -d --build
```

## ⚠️ 可能遇到的问题

### 问题1：无法连接服务器

**症状**：`ssh: connect to host 115.190.192.248 port 22: Connection refused`

**解决方案**：
1. 检查服务器是否开机
2. 检查防火墙是否开放 22 端口
3. 联系服务器提供商确认网络配置

### 问题2：部署脚本下载失败

**症状**：`curl: (6) Could not resolve host`

**解决方案**：
```bash
# 检查网络连接
ping github.com

# 如果无法访问 GitHub，可以手动下载脚本
# 或者使用代理
```

### 问题3：Docker 安装失败

**症状**：安装过程中出现错误

**解决方案**：
```bash
# 手动安装 Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh
```

### 问题4：无法访问网页

**症状**：浏览器无法打开 `http://115.190.192.248:1888`

**解决方案**：

1. **检查防火墙**：
```bash
# 查看防火墙状态
ufw status

# 如果未开放 1888 端口，执行：
ufw allow 1888/tcp
ufw reload
```

2. **检查服务是否运行**：
```bash
cd /opt/workflow
docker-compose ps
```

3. **检查端口是否被占用**：
```bash
netstat -tulpn | grep 1888
```

4. **查看错误日志**：
```bash
cd /opt/workflow
docker-compose logs
```

### 问题5：容器启动失败

**症状**：`docker-compose ps` 显示容器状态不是 `Up`

**解决方案**：
```bash
cd /opt/workflow

# 查看详细日志
docker-compose logs

# 重新构建并启动
docker-compose down
docker-compose up -d --build
```

## 🔒 安全建议

1. **修改默认密码**：首次登录后建议修改 root 密码
   ```bash
   passwd
   ```

2. **配置 SSH 密钥登录**（可选，更安全）：
   ```bash
   # 在本地电脑生成密钥对
   ssh-keygen -t rsa -b 4096
   
   # 复制公钥到服务器
   ssh-copy-id root@115.190.192.248
   ```

3. **定期更新系统**：
   ```bash
   apt update && apt upgrade -y
   ```

## 📞 获取帮助

如果遇到问题：

1. 查看部署日志：`cd /opt/workflow && docker-compose logs`
2. 查看系统日志：`journalctl -u docker`
3. 参考详细文档：`Ubuntu20.04部署指南.md`

## ✅ 部署成功标志

当你看到以下内容时，说明部署成功：

1. ✅ 脚本输出显示 "🎉 部署完成！"
2. ✅ `docker-compose ps` 显示容器状态为 `Up`
3. ✅ `curl http://localhost:1888/health` 返回成功响应
4. ✅ 浏览器可以访问 `http://115.190.192.248:1888`

## 🎉 开始使用

部署成功后，访问 `http://115.190.192.248:1888` 即可开始使用工作流程序！

首次访问需要：
1. 注册账号
2. 登录系统
3. 创建或导入工作流

祝你使用愉快！🚀
